
# Examples {#examples}

## Historical dynamics

This example illustrates specification of an operating model (OM) and simulation of historical dynamics. See Section \@ref(om-pop) for details on how to populate the OM.

```{r, eval=TRUE, echo=TRUE}
# Load necessary package
library(fishSimGTG)
library(fishSimTools)
library(here)
```

```{r, eval=TRUE, echo=TRUE}
# Populate the life history object
LifeHistoryObj <- new("LifeHistory")
LifeHistoryObj@title<-"Hawaiian Uhu - Parrotfish"
LifeHistoryObj@speciesName<-"Chlorurus perspicillatus"
LifeHistoryObj@Linf<-53.2
LifeHistoryObj@K<-0.225
LifeHistoryObj@t0<- -1.48
LifeHistoryObj@L50<-35
LifeHistoryObj@L95delta<-5
LifeHistoryObj@M<-0.16
LifeHistoryObj@L_type<-"FL"
LifeHistoryObj@L_units<-"cm"
LifeHistoryObj@LW_A<-0.0136
LifeHistoryObj@LW_B<-3.109
LifeHistoryObj@Steep<-0.6
LifeHistoryObj@isHermaph<-TRUE
LifeHistoryObj@H50<-46.2
LifeHistoryObj@H95delta<-11.8
LifeHistoryObj@recSD<-0.6
LifeHistoryObj@recRho<-0
LifeHistoryObj@R0<-10000
```

```{r, eval=TRUE, echo=TRUE}
# populate the historical fishery object
HistFisheryObj<-new("Fishery")
HistFisheryObj@title<-"Test"
HistFisheryObj@vulType<-"logistic"
HistFisheryObj@vulParams<-c(40, 1)
HistFisheryObj@retType<-"full"
HistFisheryObj@retMax <- 1
HistFisheryObj@Dmort <- 0
```

```{r, eval=TRUE, echo=TRUE}
#Populate the time-area object
#This setup will be used to produce a single-stock with no movement
#fishSimGTG requires a minimum of two areas; however we will treat those areas as a homogeneous fish stock
TimeAreaObj<-new("TimeArea")
TimeAreaObj@title = "Example"
TimeAreaObj@gtg = 13
TimeAreaObj@areas = 2
TimeAreaObj@recArea = c(0.99, 0.01)
TimeAreaObj@iterations = 3
TimeAreaObj@historicalYears = 50
TimeAreaObj@historicalBio = 0.5
TimeAreaObj@historicalBioType = "relB"
TimeAreaObj@move <- matrix(c(1,0, 0,1), nrow=2, ncol=2, byrow=FALSE)
TimeAreaObj@historicalEffort<-matrix(1:1, nrow = 50, ncol = 2, byrow = FALSE)

```

The function `LHwrapper` can be used to verify the paramaterization of the `LifeHistoryObj` object. Set `doPlot` to `TRUE` to produce a plot of life history characteristics. 

```{r lhgrouper, eval=TRUE, echo=TRUE, fig.cap= "Life history summary."}
#To simply display to the console
lhOut<-LHwrapper(LifeHistoryObj, TimeAreaObj, doPlot = TRUE)
```

```{r, eval=FALSE, echo=TRUE}
#To return life history details
lhOut
```

The function `selWrapper` can be used to verify the paramaterization of the `FisheryObj` object. Set `doPlot` to `TRUE` to produce a plot of fishery characteristics. 

```{r selgrouper, eval=TRUE, echo=TRUE, fig.cap= "Fishery summary."}
selOut<-selWrapper(lh = lhOut, TimeAreaObj, FisheryObj = HistFisheryObj, doPlot = TRUE)
```

```{r, eval=FALSE, echo=TRUE}
#To return fishery details
selOut
```

```{r, eval=TRUE, echo=TRUE}
#Populate the optional Stochastic object. 
#Here, initial biomass range is set. A value for each iteration is drawn from a uniform distribution
StochasticObj<-new("Stochastic")
StochasticObj@historicalBio = c(0.3, 0.6)
``` 

With the following objects specified, historical dynamics are simulated using the function `runProjection`.

- Life history object (`LifeHistoryObj`)
- Historical fishery object (`HistFisheryObj`)
- Time-area object (`TimeAreaObj`)
- Stochastic object (`StochasticObj`)

Notice that only historical dynamics are simulated when MP objects `StrategyObj` and `ProFisheryObj_list` are omitted from `runProjection`. Below, the diagnostic plots produced by `runProjection` illustrate patterns in the historical dynamics.

```{r, eval=TRUE, echo=TRUE}
#To return life history details
runProjection(LifeHistoryObj = LifeHistoryObj,
              TimeAreaObj = TimeAreaObj,
              HistFisheryObj = HistFisheryObj,
              StochasticObj = StochasticObj,
              wd = here('data-test', 'Historical'),
              fileName = "HistoricalDy",
              doPlot = TRUE,
              titleStrategy = "HistoricalDy"
)
```

```{r, fig.cap="Spawning biomass by area", echo=FALSE, out.height = "50%"}
knitr::include_graphics("data-test/Historical/HistoricalDy_SB_Area.png")
```

```{r, fig.cap="Catch biomass by area", echo=FALSE}
knitr::include_graphics("data-test/Historical/HistoricalDy_catchB_Area.png")
```

```{r, fig.cap="Fishing mortality by area- Higher_option2", echo=FALSE, out.width="100%"}
knitr::include_graphics("data-test/Historical/HistoricalDy_F_Area.png")
```

```{r, fig.cap="Relative spawning stock biomass, in aggregate across areas", echo=FALSE, out.width="100%"}
knitr::include_graphics("data-test/Historical/HistoricalDy_SBrel.png")
```




## Fishery projections

```{r, eval=TRUE, echo=TRUE}
ProFisheryObj<-new("Fishery")
ProFisheryObj@title<-"Test"
ProFisheryObj@vulType<-"logistic"
ProFisheryObj@vulParams<-c(19, 0.9) # excel fishery-base row3 (is proj?)
ProFisheryObj@retType<-"logistic"
ProFisheryObj@retParams <- c(22, 0.1)#excel fishery-base row3 (is proj?)
ProFisheryObj@retMax <- 1
ProFisheryObj@Dmort <- 0
```

### The management strategy

Implementing a 25% effort reduction

```{r, eval=TRUE, echo=TRUE}
StrategyObj<-new("Strategy")
StrategyObj@projectionYears <- 50
StrategyObj@projectionName<-"projectionStrategy"
# I took effort from row 3 corresponding to strategy 25% red
eff_vector=scan(text=("0	0	0	0	1.125	1.125	1.125	1.125	1.125	1.125	1.125	1.125	1.125	1.125	1.125	1.125	1.125	1.125	1.125	1.125	1.125	1.125	1.125	1.125	1.125	1.125	1.125	1.125	1.125	1.125	1.125	1.125	1.125	1.125	1.125	1.125	1.125	1.125	1.125	1.125	1.125	1.125	1.125	1.125	1.125	1.125	1.125	1.125	1.125	1.125	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	1.125	1.125	1.125	1.125	1.125	1.125	1.125	1.125	1.125	1.125	1.125	1.125	1.125	1.125	1.125	1.125	1.125	1.125	1.125	1.125	1.125	1.125	1.125	1.125	1.125	1.125	1.125	1.125	1.125	1.125	1.125	1.125	1.125	1.125	1.125	1.125	1.125	1.125	1.125	1.125	1.125	1.125	1.125	1.125	1.125	1.125	1	1	1	1	1	1	1	1	1	1	1	1	1	1	1	1	1	1	1	1	1	1	1	1	1	1	1	1	1	1	1	1	1	1	1	1	1	1	1	1	1	1	1	1	1	1	1	1	1	1"))

# StrategyObj@projectionParams<-list(bag = c(-99	-99	-99	-99
# ), effort = matrix(eff_vector, nrow=50, ncol=4, byrow = FALSE), CPUE = c(1,2), CPUEtype = 'retN') # CPUE is strategy excel proj_CPUE?
```
### Projection modeling {#examples-projection}
